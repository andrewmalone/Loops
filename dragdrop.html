<!DOCTYPE html>
<html lang="en"> 
<head>
<title>Loops</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<!-- @reload -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="js/interaction.js"></script>

<style>
.pattern {
    width:1.2em;
    height:1.2em;
    border:1px solid black;
    float:left;
    margin-right:1em;
    cursor: default;
}
.pattern.over {
    border:1px solid red;
}
.pattern.shadow {
    background:#ccc;
    position:absolute;
    top:0;
    left:0;
}
</style>
</head>
<body>
<div id="patterns">
</div>

<script>
window.requestAnimFrame = (function(){
    return  window.requestAnimationFrame ||
    window.webkitRequestAnimationFrame ||
    window.mozRequestAnimationFrame ||
    window.oRequestAnimationFrame ||
    window.msRequestAnimationFrame ||
    function( callback ){
        window.setTimeout(callback, 1000 / 60);
    };
})();
window.cancelAnimFrame = (function(){
	return window.cancelAnimationFrame ||
	window.webkitCancelAnimationFrame;
})();

var div = $("#patterns")
for (var i = 0; i < 8; i++)
{
    div.append($("<div class='pattern'>").text(i+1).attr("id","p"+i))
}
div.addInteraction(".pattern", {
    init: function(element, e)
    {
        var data = {}
        data.shadow = element.clone().addClass("shadow").appendTo(document.body)
        data.offsetX = element.offset().left
        data.offsetY = element.offset().top
        data.shadow.css({left: data.offsetX+"px", top: data.offsetY+"px"})
        data.isOver = false;
        // get the drop zones...
        data.drops = []
        element.siblings(".pattern").each(function() {
            var left = $(this).offset().left
            var top = $(this).offset().top
            var right = left + $(this).outerWidth()
            var bottom = top + $(this).outerHeight()
            data.drops.push([[left, right],[top, bottom], $(this)])
        })
        return data
    },
    drag: function(data, e)
    {
        var px = data.offsetX + data.deltaX
        var py = data.offsetY - data.deltaY
        var x = e.pageX
	    var y = e.pageY
        requestAnimFrame(function() {
            data.shadow.css({left: px+"px", top: py+"px"})
            //console.log(data.shadow.css("left"));
        });
        // look for drop zones...
        if (data.isOver === false)
        {
	        for (var i = 0, len = data.drops.length; i < len; i++)
	        {
	            var drop = data.drops[i];
	            if (x > drop[0][0] && x < drop[0][1] && y > drop[1][0] && y < drop[1][1])
	            {
	                // can this be optimized?
	                // we have an over here!
	                data.isOver = i;
	                drop[2].addClass("over");
	                break;
	            }
	        }
	    }
	    else
	    {
		    // check if we are outside of the current drop zone
		    var drop = data.drops[data.isOver];
		    if (x < drop[0][0] || x > drop[0][1] || y < drop[1][0] || y > drop[1][1])
		    {
			    // not over anymore!
			    drop[2].removeClass("over");
			    data.isOver = false;
		    }
	    }
    },
    up: function(data)
    {
    	if (data.isOver !== false)
    	{
    		var drop = data.drops[data.isOver][2]
	    	drop.removeClass("over");
	    	// we had a drop! (what do we do now?)
    	}
        data.shadow.remove()
    }
})
</script>
</body>
</html>